<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ä»ªè¡¨ç›˜</title>
    <style>
        :root {
            /* é»˜è®¤æ˜¯æ·±è‰²ä¸»é¢˜çš„å˜é‡ */
            --font-primary: 'Google Sans', 'Roboto', sans-serif;
            --color-text-primary: #FFFFFF;
            --color-text-secondary: #E0E0E0;
            --color-text-muted: #BDBDBD;
            --card-bg-color: rgba(0, 0, 0, 0.2);
            --card-bg-hover-color: rgba(0, 0, 0, 0.3);
            --card-border-radius: 28px;
            --blur-effect: blur(15px);
            --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        body.light-mode {
            --color-text-primary: #1f1f1f;
            --color-text-secondary: #333333;
            --color-text-muted: #5f5f5f;
            --card-bg-color: rgba(255, 255, 255, 0.5);
            --card-bg-hover-color: rgba(255, 255, 255, 0.7);
            --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.15);
        }

        @font-face {
            font-family: 'Google Sans';
            src: url('https://fonts.gstatic.com/s/googlesans/v46/4UaGrENHsxJlGDuGoTVjPE_Fh_f-jX1mF4TCyWw_LzZ-D-6M.woff2') format('woff2');
            font-weight: 400 500; font-style: normal; font-display: swap;
        }

        body {
            display: grid; place-items: center; min-height: 100vh; margin: 0;
            font-family: var(--font-primary);
            color: var(--color-text-primary);
            text-align: center; padding: 20px; box-sizing: border-box;
            background-image: url('https://imgapi.xl0408.top/index.php');
            background-size: cover; background-position: center; background-attachment: fixed;
            transition: color 0.3s ease;
        }
        
        #main-card {
            position: relative;
            display: flex; flex-direction: column; align-items: center;
            gap: 25px; padding: 20px; width: 100%; max-width: 800px;
        }

        #theme-toggle {
            position: absolute; top: 25px; right: 25px;
            background: var(--card-bg-color); border: none; color: var(--color-text-primary);
            width: 45px; height: 45px; border-radius: 50%;
            font-size: 24px; cursor: pointer; display: grid; place-items: center;
            backdrop-filter: var(--blur-effect); box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
        }
        #theme-toggle:hover { transform: scale(1.1); }
        
        #search-box { width: 100%; max-width: 600px; }
        #search-input {
            width: 100%; box-sizing: border-box; padding: 15px 25px; font-size: 18px;
            background-color: var(--card-bg-color); border: none; border-radius: var(--card-border-radius);
            color: var(--color-text-primary); outline: none; backdrop-filter: var(--blur-effect);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2); transition: background-color 0.3s ease;
        }
        #search-input::placeholder { color: var(--color-text-muted); }
        #search-input:focus { background-color: var(--card-bg-hover-color); }
        
        #greeting-section { font-size: 24px; color: var(--color-text-muted); }
        #date-display { font-size: 18px; margin-top: 5px; }

        .info-group { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* è°ƒæ•´æœ€å°å®½åº¦ä»¥é€‚åº”2ä¸ªå¡ç‰‡ */
            gap: 20px;
            width: 100%;
        }
        
        .glass-card {
            background-color: var(--card-bg-color); color: var(--color-text-secondary);
            padding: 20px 30px; border-radius: var(--card-border-radius);
            backdrop-filter: var(--blur-effect); box-shadow: var(--card-shadow);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
        }
        
        .info-item {
            display: flex; flex-direction: column;
            align-items: flex-start; text-align: left;
        }
        .info-item:hover {
            background-color: var(--card-bg-hover-color);
            transform: translateY(-5px);
        }
        .info-label { font-size: 14px; color: var(--color-text-muted); margin-bottom: 5px; text-transform: uppercase; }
        .info-text { font-size: 24px; font-weight: 500; }
        .card-details { margin-top: 10px; font-size: 16px; color: var(--color-text-muted); }

        .ping-controls {
            display: flex; gap: 10px; width: 100%; margin-top: 15px;
        }
        #ping-url-input {
            flex-grow: 1; background: rgba(0,0,0,0.2);
            border: 1px solid var(--card-bg-hover-color); border-radius: 8px;
            color: var(--color-text-primary); padding: 8px 10px; font-size: 14px; outline: none;
        }
        #ping-test-btn {
            background: var(--card-bg-hover-color); border: none; color: var(--color-text-secondary);
            font-weight: 500; border-radius: 8px; padding: 8px 15px; cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #ping-test-btn:hover {
            background: rgba(255,255,255,0.2); color: var(--color-text-primary);
        }
        
        /* --- å¸ƒå±€è°ƒæ•´ï¼šè®©Pingå¡ç‰‡å•ç‹¬ä¸€è¡Œ --- */
        #ping-card {
            grid-column: 1 / -1; /* è®©æ­¤å…ƒç´ æ¨ªè·¨æ•´ä¸ªç½‘æ ¼ */
        }

        @media (max-width: 768px) {
            #theme-toggle { top: 15px; right: 15px; width: 40px; height: 40px; font-size: 20px; }
            .info-group { grid-template-columns: 1fr; } /* åœ¨å°å±å¹•ä¸Šï¼Œæ‰€æœ‰å¡ç‰‡éƒ½å•ç‹¬ä¸€è¡Œ */
        }
    </style>
</head>
<body>
<div id="main-card">
    <button id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜"></button>
    
    <div id="search-box">
        <input type="text" id="search-input" placeholder="ä½¿ç”¨å¿…åº”æœç´¢" />
    </div>
    <div id="greeting-section">
        <div id="greeting-text">...</div>
        <div id="date-display">...</div>
    </div>

    <div class="info-group">
        <div id="ip-card" class="info-item glass-card">
            <span class="info-label">IP åœ°å€</span>
            <span id="ip-text" class="info-text">æ­£åœ¨è·å–...</span>
        </div>
        <div id="location-card" class="info-item glass-card">
            <span class="info-label">ä½ç½®</span>
            <span id="location-text" class="info-text">...</span>
        </div>
        <div id="ping-card" class="info-item glass-card">
            <span class="info-label">ç½‘ç»œå»¶è¿Ÿ</span>
            <span id="ping-text" class="info-text">-- ms</span>
            <div class="ping-controls">
                <input type="text" id="ping-url-input" placeholder="å¦‚ baidu.com">
                <button id="ping-test-btn">æµ‹è¯•</button>
            </div>
        </div>
    </div>
</div>

<script>
(() => {
    // --- JSæ”¹åŠ¨: ç¼“å­˜çš„å…ƒç´ å·²æ›´æ–° ---
    const elements = {
        themeToggle: document.getElementById('theme-toggle'),
        greetingText: document.getElementById('greeting-text'),
        dateDisplay: document.getElementById('date-display'),
        searchInput: document.getElementById('search-input'),
        ipText: document.getElementById('ip-text'),
        locationText: document.getElementById('location-text'),
        pingText: document.getElementById('ping-text'),
        pingUrlInput: document.getElementById('ping-url-input'),
        pingTestBtn: document.getElementById('ping-test-btn'),
    };

    // --- å·²åˆ é™¤ handleBattery å’Œ handleNetwork å‡½æ•° ---

    function handleTheme() {
        const body = document.body;
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'light') {
            body.classList.add('light-mode');
            elements.themeToggle.innerHTML = 'ğŸŒ™';
        } else {
            elements.themeToggle.innerHTML = 'â˜€ï¸';
        }
        elements.themeToggle.addEventListener('click', () => {
            body.classList.toggle('light-mode');
            if (body.classList.contains('light-mode')) {
                localStorage.setItem('theme', 'light');
                elements.themeToggle.innerHTML = 'ğŸŒ™';
            } else {
                localStorage.setItem('theme', 'dark');
                elements.themeToggle.innerHTML = 'â˜€ï¸';
            }
        });
    }

    function getGreeting() { /* ...å†…å®¹æ— å˜åŒ–... */ }
    function updateDate() { /* ...å†…å®¹æ— å˜åŒ–... */ }
    function handleSearch() { /* ...å†…å®¹æ— å˜åŒ–... */ }
    
    // --- ä¿®å¤ï¼šIP åœ°å€è·å–é€»è¾‘ ---
    async function fetchIPAddress() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            if (!response.ok) throw new Error('IP API è¯·æ±‚å¤±è´¥');
            const data = await response.json();
            elements.ipText.textContent = data.ip;
            return data.ip;
        } catch (error) {
            console.error('è·å–IPåœ°å€å¤±è´¥:', error);
            elements.ipText.textContent = 'è·å–å¤±è´¥';
            return null;
        }
    }
    
    // --- ä¿®å¤ï¼šä½¿ç”¨æ–°çš„HTTPS APIè·å–åœ°ç†ä½ç½® ---
    async function fetchLocation(ip) {
        if (!ip) {
            elements.locationText.textContent = 'IPæ— æ•ˆ';
            return;
        }
        try {
            // ä½¿ç”¨ ipinfo.io, è¿™æ˜¯ä¸€ä¸ªå¯é çš„HTTPS API
            const response = await fetch(`https://ipinfo.io/${ip}/json`);
            if (!response.ok) throw new Error('Location API è¯·æ±‚å¤±è´¥');
            const data = await response.json();
            if (data && !data.error) {
                elements.locationText.textContent = `${data.country}, ${data.city}`;
            } else {
                elements.locationText.textContent = 'æŸ¥è¯¢å¤±è´¥';
            }
        } catch (error) {
            console.error('è·å–ä½ç½®ä¿¡æ¯å¤±è´¥:', error);
            elements.locationText.textContent = 'è·å–å¤±è´¥';
        }
    }

    async function measurePing(url) {
        elements.pingText.textContent = 'æµ‹è¯•ä¸­...';
        elements.pingText.style.color = ''; // æ¢å¤é»˜è®¤é¢œè‰²
        const startTime = performance.now();
        try {
            await fetch(url + '?_t=' + Date.now(), { method: 'HEAD', mode: 'no-cors', cache: 'no-store' });
            const endTime = performance.now();
            const latency = Math.round(endTime - startTime);
            
            elements.pingText.textContent = `${latency} ms`;
            if (latency < 100) elements.pingText.style.color = '#66bb6a'; // ç›´æ¥ä½¿ç”¨é¢œè‰²å€¼
            else if (latency < 300) elements.pingText.style.color = '#ffa726';
            else elements.pingText.style.color = '#ef5350';
        } catch (error) {
            elements.pingText.textContent = 'æµ‹è¯•å¤±è´¥';
            elements.pingText.style.color = '#ef5350';
        }
    }

    function handlePingTest() {
        const runTest = () => {
            let url = elements.pingUrlInput.value.trim();
            if (!url) { alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„ç½‘å€ï¼'); return; }
            if (!url.startsWith('http')) { url = 'https://' + url; }
            measurePing(url + '/favicon.ico');
        };
        elements.pingTestBtn.addEventListener('click', runTest);
        elements.pingUrlInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') runTest();
        });
    }

    async function init() {
        handleTheme();
        getGreeting();
        updateDate();
        handleSearch();
        handlePingTest();
        
        const ip = await fetchIPAddress();
        if (ip) {
            fetchLocation(ip);
        }
    }

    document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>